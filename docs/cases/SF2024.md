# San Francisco County 2024
02/20/2026

From Dice dont Slice paper:

    We consider the 2024 mayoral race in San Francisco as a case study. This instant-
    runoff voting (IRV) contest included thirteen candidates. Daniel Lurie, who
    received 26% of the first-choice selections and 55% after all but two candidates
    were eliminated, defeated incumbent London Breed, who received 24% of the
    first-choice elections and 45% of the final round votes.
    
    The election produced 1,603,908 CVRs, of which 216,286 were for cards cast in 4,223 precinct batches
    and 1,387,622 CVRs were for vote-by-mail (VBM) cards.

    VBM CVRs are linked to the corresponding card, facilitating ballot-level
    comparison auditing, but the in-person CVRs are not linked to individual cards,
    only to tabulation batches. The CVRs were incorporated into the audit using
    ONEAudit. RAIRE [4] was used to generate the assertions for the audit to test.

From https://github.com/spertus/UI-TS/blob/main/Code/SF_oneaudit_example.ipynb:

    Download the SF CVRs from https://sfelections.org/results/20241105w/detail.html
    Under the 'Final Report' tab click "Cast Vote Record (Raw data) - JSON" to download a zip file with all the CVRs.

This zip file CVR_Export_20241202143051.zip (296 MB) contains 27,570 files:

    BallotTypeContestManifest.json
    BallotTypeManifest.json
    CandidateManifest.json
    Configuration.json
    ContestManifest.json
    CountingGroupManifest.json
    CvrExport_0.json
    CvrExport_10000.json
    CvrExport_10001.json
    CvrExport_10002.json
    ...

Input is in _CVR_Export_20241202143051.zip_. This contains the Dominion CVR_Export JSON files, as well as the
Contest Manifest, Candidate Manifest, and other manifests. We also have the San Francisco County _summary.xml_ file from
their website for corroboration. The summary.xml ncards match the CVRS exactly, so there are no phantoms.

## SF2024 characteristics

* 1,603,908 cvrs
* 53 contests, 11 IRV
* 4224 pools with 216286 cards (13.5%), using SHANGRLA grouping.
* Many pools have only a few cards.

## Creating the SF2024 election

Follow the instructions in [Getting Started](../docs/Developer.md#test-cases) to download and process the SF2024 data.
This is only done once.

Using _cases/src/test/kotlin/org/cryptobiotic/rlauxe/util/TestGenerateAllUseCases.kt_:

* run createSFElectionOA() to create a OneAudit elction in  _$testdataDir/cases/sf2024/oa/audit_
* run createSFElectionClca() to create a CLCA elction in  _$testdataDir/cases/sf2024/clca/audit_

### Notes on election creation

**CreateSfElection/CreateSfElectionNoStyles**: We read the CVR_Export files
and write equivilent csv files in our own "AuditableCard" format to a temporary "cvrExport.csv" file.
We make the contests from the information in ContestManifest and CandidateManifest files,
and tabulate the votes from the cvrs. If its an IRV contest, we use the raire-java library to create the Raire assertions.
We write the auditConfig.json (which contains the prn seed) and contests.json files to the audit directory.

**createSortedCards**: Using the prn seed, we assign prns to all cvrs and rewrite the cvrs to sortedCards.csv (optionally zipped), using an out-of-memory
sorting algorithm.

The CVRs are in two groups, "mail-in" and "in-person".

**createSFElectionOA():** creates a OneAudit Electio where the in-person ballots cannot be matched to their CVRs.
We put the in-person cvrs into pools by precinct, and use them to calculate the pool averages for Plurality and the VoteConsolidators for IRV.
This is done for each pool and assorter. 

**createSFElectionClca()** assumes we can match all CVRs to physical ballots, so we can do a regular CLCA.
This allows us to compare the cost of OneAudit vs CLCA.
